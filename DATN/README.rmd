# Dá»± Ã¡n Robot Tá»± CÃ¢n Báº±ng 2 BÃ¡nh vá»›i CÆ¡ cáº¥u HÃ´ng (Arduino)

## Giá»›i thiá»‡u
ÄÃ¢y lÃ  mÃ£ nguá»“n Ä‘iá»u khiá»ƒn cho má»™t robot tá»± cÃ¢n báº±ng hai bÃ¡nh, Ä‘Æ°á»£c trang bá»‹ thÃªm má»™t cÆ¡ cáº¥u hÃ´ng (hip mechanism) Ä‘á»ƒ thay Ä‘á»•i chiá»u cao vÃ  trá»ng tÃ¢m. Robot sá»­ dá»¥ng bá»™ Ä‘iá»u khiá»ƒn LQR (Linear-Quadratic Regulator) Ä‘á»ƒ giá»¯ thÄƒng báº±ng vÃ  di chuyá»ƒn, káº¿t há»£p vá»›i bá»™ Ä‘iá»u khiá»ƒn PID (hoáº·c Fuzzy logic) Ä‘á»ƒ Ä‘iá»u khiá»ƒn vá»‹ trÃ­ cá»§a cÆ¡ cáº¥u hÃ´ng.

MÃ£ nguá»“n nÃ y Ä‘Ã£ Ä‘Æ°á»£c tÃ¡i cáº¥u trÃºc (refactoring) thÃ nh cÃ¡c module riÃªng biá»‡t, giÃºp viá»‡c Ä‘á»c hiá»ƒu, báº£o trÃ¬, vÃ  phÃ¡t triá»ƒn trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n so vá»›i viá»‡c viáº¿t táº¥t cáº£ trong má»™t tá»‡p duy nháº¥t.

## TÃ­nh nÄƒng chÃ­nh âœ¨
- **Tá»± cÃ¢n báº±ng**: Sá»­ dá»¥ng cáº£m biáº¿n IMU MPU9250 vÃ  bá»™ Ä‘iá»u khiá»ƒn LQR Ä‘á»ƒ duy trÃ¬ tráº¡ng thÃ¡i cÃ¢n báº±ng Ä‘á»™ng.
- **Äiá»u khiá»ƒn di chuyá»ƒn**: Cho phÃ©p robot di chuyá»ƒn tiáº¿n, lÃ¹i vÃ  xoay.
- **CÆ¡ cáº¥u hÃ´ng linh hoáº¡t**: Äiá»u khiá»ƒn Ä‘á»™ng cÆ¡ DC á»Ÿ hÃ´ng Ä‘á»ƒ thay Ä‘á»•i chiá»u cao cá»§a robot, Ä‘i theo má»™t quá»¹ Ä‘áº¡o Ä‘áº·t trÆ°á»›c.
- **MÃ£ nguá»“n Module hÃ³a**: Code Ä‘Æ°á»£c phÃ¢n chia rÃµ rÃ ng thÃ nh cÃ¡c tá»‡p chá»©c nÄƒng (cáº£m biáº¿n, Ä‘iá»u khiá»ƒn Ä‘á»™ng cÆ¡, thuáº­t toÃ¡n, giao tiáº¿p).
- **Cáº¥u hÃ¬nh táº­p trung**: Táº¥t cáº£ cÃ¡c thÃ´ng sá»‘ quan trá»ng (chÃ¢n cáº¯m, háº±ng sá»‘ PID/LQR, offset cáº£m biáº¿n) Ä‘á»u Ä‘Æ°á»£c Ä‘áº·t trong tá»‡p `config.h` Ä‘á»ƒ dá»… dÃ ng tinh chá»‰nh.
- **Giao tiáº¿p qua Serial**: Nháº­n lá»‡nh Ä‘iá»u khiá»ƒn vÃ  gá»­i dá»¯ liá»‡u tráº¡ng thÃ¡i (telemetry) vá» mÃ¡y tÃ­nh Ä‘á»ƒ giÃ¡m sÃ¡t vÃ  gá»¡ lá»—i.

## YÃªu cáº§u Pháº§n cá»©ng âš™ï¸
- **Vi Ä‘iá»u khiá»ƒn**: Arduino Mega 2560 (hoáº·c má»™t board tÆ°Æ¡ng tá»± cÃ³ Ä‘á»§ chÃ¢n ngáº¯t vÃ  ngoáº¡i vi).
- **Cáº£m biáº¿n**: IMU MPU9250 (hoáº·c MPU9150/MPU6050 vá»›i má»™t vÃ i chá»‰nh sá»­a nhá»).
- **Äá»™ng cÆ¡**:
  - 2 x Äá»™ng cÆ¡ DC cÃ³ encoder cho hai bÃ¡nh xe.
  - 1 x Äá»™ng cÆ¡ DC cÃ³ encoder cho cÆ¡ cáº¥u hÃ´ng.
- **Máº¡ch Ä‘iá»u khiá»ƒn Ä‘á»™ng cÆ¡ (Driver)**: 3 x Máº¡ch cáº§u H (vÃ­ dá»¥: L298N) Ä‘á»ƒ Ä‘iá»u khiá»ƒn 3 Ä‘á»™ng cÆ¡.
- **Nguá»“n Ä‘iá»‡n**: Pin LiPo hoáº·c nguá»“n DC phÃ¹ há»£p vá»›i Ä‘iá»‡n Ã¡p cá»§a Ä‘á»™ng cÆ¡.
- **Khung robot**: Khung cÆ¡ khÃ­ cho robot 2 bÃ¡nh vÃ  cÆ¡ cáº¥u hÃ´ng.

## Pháº§n má»m & ThÆ° viá»‡n ğŸ“š
- **IDE**: Arduino IDE
- **ThÆ° viá»‡n cáº§n cÃ i Ä‘áº·t**:
  - I2Cdev
  - MPU9250 (hoáº·c thÆ° viá»‡n tÆ°Æ¡ng á»©ng vá»›i cáº£m biáº¿n cá»§a báº¡n)
  - TimerOne
  - TimerFour

CÃ¡ch cÃ i Ä‘áº·t thÆ° viá»‡n: Má»Ÿ Arduino IDE, vÃ o **Sketch** -> **Include Library** -> **Manage Libraries....** TÃ¬m kiáº¿m tÃªn thÆ° viá»‡n vÃ  nháº¥n **Install**.

## Cáº¥u trÃºc MÃ£ nguá»“n ğŸ“
Dá»± Ã¡n Ä‘Æ°á»£c tá»• chá»©c thÃ nh cÃ¡c tá»‡p logic Ä‘á»ƒ quáº£n lÃ½ code hiá»‡u quáº£:
- **main.cpp**: Tá»‡p chÃ­nh cá»§a Arduino, chá»©a cÃ¡c hÃ m `setup()` vÃ  `loop()`. NÃ³ Ä‘iá»u phá»‘i hoáº¡t Ä‘á»™ng cá»§a cÃ¡c module khÃ¡c.
- **config.h**: Tá»‡p quan trá»ng nháº¥t Ä‘á»ƒ tinh chá»‰nh. Chá»©a táº¥t cáº£ cÃ¡c háº±ng sá»‘, chÃ¢n cáº¯m (pin), vÃ  tham sá»‘ cho bá»™ Ä‘iá»u khiá»ƒn (PID, LQR).
- **globals.h / globals.cpp**: Quáº£n lÃ½ táº¥t cáº£ cÃ¡c biáº¿n toÃ n cá»¥c (biáº¿n tráº¡ng thÃ¡i cá»§a robot), giÃºp trÃ¡nh xung Ä‘á»™t vÃ  dá»… theo dÃµi.
- **imu_sensor.h / imu_sensor.cpp**: Module dÃ nh riÃªng cho cáº£m biáº¿n IMU. Chá»‹u trÃ¡ch nhiá»‡m khá»Ÿi táº¡o, Ä‘á»c vÃ  xá»­ lÃ½ dá»¯ liá»‡u gÃ³c vÃ  gia tá»‘c.
- **motor_control.h / motor_control.cpp**: Module Ä‘iá»u khiá»ƒn táº¥t cáº£ cÃ¡c Ä‘á»™ng cÆ¡. Bao gá»“m cÃ¡c hÃ m Ä‘iá»u khiá»ƒn PWM, Ä‘á»c encoder, vÃ  xá»­ lÃ½ ngáº¯t (ISR).
- **controller.h / controller.cpp**: Bá»™ nÃ£o cá»§a robot. Chá»©a logic Ä‘iá»u khiá»ƒn chÃ­nh nhÆ° thuáº­t toÃ¡n LQR, PID cho Ä‘á»™ng cÆ¡ hÃ´ng, vÃ  cÃ¡c hÃ m tÃ­nh toÃ¡n quá»¹ Ä‘áº¡o.
- **communication.h / communication.cpp**: Module xá»­ lÃ½ giao tiáº¿p qua cá»•ng Serial. Chá»‹u trÃ¡ch nhiá»‡m nháº­n lá»‡nh Ä‘iá»u khiá»ƒn tá»« mÃ¡y tÃ­nh vÃ  gá»­i dá»¯ liá»‡u tráº¡ng thÃ¡i vá».

## CÃ i Ä‘áº·t vÃ  Cháº¡y thá»­ ğŸš€
1. **Clone/Táº£i vá»**: Táº£i toÃ n bá»™ cÃ¡c tá»‡p mÃ£ nguá»“n vÃ o má»™t thÆ° má»¥c trÃªn mÃ¡y tÃ­nh cá»§a báº¡n.
2. **Láº¯p Ä‘áº·t Pháº§n cá»©ng**: Káº¿t ná»‘i táº¥t cáº£ cÃ¡c thÃ nh pháº§n (vi Ä‘iá»u khiá»ƒn, cáº£m biáº¿n, driver, Ä‘á»™ng cÆ¡) theo sÆ¡ Ä‘á»“ chÃ¢n Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong tá»‡p `config.h`.
3. **CÃ i Ä‘áº·t ThÆ° viá»‡n**: Má»Ÿ Arduino IDE vÃ  cÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n Ä‘Æ°á»£c liá»‡t kÃª á»Ÿ trÃªn.
4. **Hiá»‡u chá»‰nh config.h**:
   - Äáº£m báº£o cÃ¡c chÃ¢n cáº¯m trong `chan_out` vÃ  `chan_in` khá»›p vá»›i káº¿t ná»‘i pháº§n cá»©ng cá»§a báº¡n.
   - Quan trá»ng: Cháº¡y má»™t sketch hiá»‡u chá»‰nh MPU9250 riÃªng Ä‘á»ƒ tÃ¬m cÃ¡c giÃ¡ trá»‹ offset cho cáº£m biáº¿n cá»§a báº¡n vÃ  cáº­p nháº­t chÃºng trong `config.h`.
5. **BiÃªn dá»‹ch vÃ  Náº¡p code**: Má»Ÿ tá»‡p `.ino` báº±ng Arduino IDE, chá»n Ä‘Ãºng loáº¡i board (Arduino Mega 2560) vÃ  cá»•ng COM, sau Ä‘Ã³ nháº¥n nÃºt **Upload**.
6. **GiÃ¡m sÃ¡t**: Má»Ÿ **Serial Monitor** (tá»‘c Ä‘á»™ baud 115200) Ä‘á»ƒ xem dá»¯ liá»‡u telemetry tá»« robot.

## Giao thá»©c Giao tiáº¿p ğŸ“¡
- **Robot nháº­n cÃ¡c lá»‡nh Ä‘iá»u khiá»ƒn** qua Serial3 dÆ°á»›i dáº¡ng cÃ¡c kÃ½ tá»± Ä‘Æ¡n, theo sau lÃ  cÃ¡c giÃ¡ trá»‹ sá»‘ náº¿u cáº§n.
  - `'U'`: Tiáº¿n má»™t chÃºt.
  - `'D'`: LÃ¹i má»™t chÃºt.
  - `'R'`: Xoay pháº£i má»™t chÃºt.
  - `'L'`: Xoay trÃ¡i má»™t chÃºt.
  - `'H'`: Dá»«ng di chuyá»ƒn (váº«n giá»¯ thÄƒng báº±ng).
  - `'P'`: Gá»­i thÃ´ng sá»‘ LQR má»›i. VÃ­ dá»¥: `P20.6,38.8,915,510,40,45`
  - `'I'`: Gá»­i thÃ´ng sá»‘ PID vÃ  gÃ³c Ä‘áº·t cho hÃ´ng. VÃ­ dá»¥: `I-15,0.3,0.01,45.0`
  
- **Dá»¯ liá»‡u gá»­i tá»« robot vá» mÃ¡y tÃ­nh (qua Serial)** cÃ³ Ä‘á»‹nh dáº¡ng: `a<val>b<val>c<val>...k` Ä‘á»ƒ dá»… dÃ ng phÃ¢n tÃ­ch báº±ng cÃ¡c pháº§n má»m nhÆ° **Processing** hoáº·c **Python**.

## TÃ¡c giáº£
(Nguyen Minh Hoang)

## Giáº¥y phÃ©p
Dá»± Ã¡n nÃ y Ä‘Æ°á»£c cáº¥p phÃ©p theo Giáº¥y phÃ©p MIT - xem tá»‡p `LICENSE.md` Ä‘á»ƒ biáº¿t chi tiáº¿t.
